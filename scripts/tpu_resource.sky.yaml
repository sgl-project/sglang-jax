# Launch TPU resources for development with SkyPilot command:
#   sky launch tpu_resource.sky.yaml
resources:
  accelerators: $ACCELERATOR
  accelerator_args:
      tpu_vm: True
      runtime_version: v2-alpha-tpuv6e
  use_spot: True # The default instance is spot.

setup: |
  if [ -d "sglang-jax" ]; then pip uninstall -y sgl-jax || true && rm -rf sglang-jax; fi
  git clone https://github.com/sgl-project/sglang-jax.git
  cd sglang-jax && git fetch origin $REF:$REF && git checkout $REF
  uv venv --python 3.12
  source .venv/bin/activate
  uv pip install -e "python[all]"
  bash scripts/killall_sglang.sh
  uv tool install evalscope
